<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Details</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        let carsData = [];  // To store car data parsed from CSV
        let brands = [];    // List of car brands from CSV

        // Function to read the CSV data (simulate what you had in Python)
        function loadCSV() {
            Papa.parse('cars.csv', {
                download: true,
                complete: function(results) {
                    carsData = results.data;
                    brands = [...new Set(carsData.map(car => car.brand))].sort();
                    populateBrands();
                }
            });
        }

        // Populate the brand checkboxes
        function populateBrands() {
            const brandContainer = document.getElementById('brand-container');
            brandContainer.innerHTML = '';
            brands.forEach(brand => {
                const label = document.createElement('label');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = 'brand';
                checkbox.value = brand;
                checkbox.addEventListener('change', updateModels);
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(brand));
                brandContainer.appendChild(label);
                brandContainer.appendChild(document.createElement('br'));
            });
        }

        // Update models based on selected brands
        function updateModels() {
            const selectedBrands = Array.from(document.querySelectorAll('input[name="brand"]:checked')).map(cb => cb.value);
            const models = [...new Set(carsData.filter(car => selectedBrands.includes(car.brand)).map(car => car.model))].sort();
            const modelSelect = document.getElementById('model');
            modelSelect.innerHTML = '<option value="">Select Model</option>';
            models.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                modelSelect.appendChild(option);
            });
        }

        // Update production years based on selected brand and model
        function updateYears() {
            const selectedBrand = Array.from(document.querySelectorAll('input[name="brand"]:checked')).map(cb => cb.value)[0];
            const selectedModel = document.getElementById('model').value;
            const years = [...new Set(carsData.filter(car => car.brand === selectedBrand && car.model === selectedModel).map(car => car.production_years))].sort();
            const yearSelect = document.getElementById('production_year');
            yearSelect.innerHTML = '<option value="">Select Year</option>';
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            });
        }

        // Generate the raw HTML code output
        function generateHTMLCode() {
            const selectedBrands = Array.from(document.querySelectorAll('input[name="brand"]:checked')).map(cb => cb.value);
            const selectedModel = document.getElementById('model').value;
            const selectedYear = document.getElementById('production_year').value;
            const pcd = document.getElementById('pcd').value;
            const cb = document.getElementById('cb').value;
            const et = document.getElementById('et').value;
            const contact = document.getElementById('contact').value;
            const MAIL = document.getElementById('MAIL').value;
            const FEEDBACK = document.getElementById('FEEDBACK').value;
            const Spedizione = document.getElementById('Spedizione').value;

            // Filter selected cars
            const selectedCars = carsData.filter(car => selectedBrands.includes(car.brand) && car.model === selectedModel && car.production_years === selectedYear);

            let rawHTML = '';

            selectedCars.forEach(car => {
                rawHTML += `<h3>MARCA: ${car.brand}</h3>`;
                rawHTML += `<h3>MODELLO: ${car.model}</h3>`;
                rawHTML += `<h3>ANNO: ${car.production_years}</h3>`;
                rawHTML += `<p style="font-size: 25px;">PCD: ${pcd}</p>`;
                rawHTML += `<p style="font-size: 25px;">CB: ${cb}</p>`;
                rawHTML += `<p style="font-size: 25px;">ET: ${et}</p>`;
                rawHTML += `<p style="font-size: 25px;">Contact: ${contact}</p>`;
                rawHTML += `<p style="font-size: 25px;">Email: ${MAIL}</p>`;
                rawHTML += `<p style="font-size: 25px;">Feedback: ${FEEDBACK}</p>`;
                rawHTML += `<p style="font-size: 25px;">Spedizione: ${Spedizione}</p>`;
                rawHTML += '<div>';
                car.image_urls.split(',').forEach(imageUrl => {
                    rawHTML += `<img src="${imageUrl}" alt="Car Image" style="width: 200px; margin: 10px;">`;
                });
                rawHTML += '</div>';
            });

            // Display the raw HTML code
            const rawHtmlContainer = document.getElementById('raw-html-output');
            rawHtmlContainer.textContent = rawHTML; // Display the raw HTML as text
        }

        // On page load, load the CSV data
        window.onload = loadCSV;
    </script>
</head>
<body>
    <h1>TEAM VEGLIANTE SERVIZI</h1>

    <!-- User Type Selection -->
    <label for="user_type">Select User Type:</label><br>
    <input type="radio" name="user_type" value="mondoruote" id="mondoruote" onchange="updateUserImage()"> Mondoruote<br>
    <input type="radio" name="user_type" value="teamvegliante" id="teamvegliante" onchange="updateUserImage()"> Teamvegliante<br><br>

    <!-- Brand Selection -->
    <label for="brand">Brand(s):</label><br>
    <div id="brand-container"></div><br>

    <!-- Model and Year Selection -->
    <label for="model">Model:</label>
    <select name="model" id="model" onchange="updateYears()">
        <option value="">Select Model</option>
    </select><br><br>

    <label for="production_year">Production Year:</label>
    <select name="production_year" id="production_year">
        <option value="">Select Year</option>
    </select><br><br>

    <!-- Other Inputs -->
    <label for="pcd">PCD:</label>
    <input type="text" name="pcd" id="pcd"><br><br>

    <label for="cb">CB:</label>
    <input type="text" name="cb" id="cb"><br><br>

    <label for="et">ET:</label>
    <input type="text" name="et" id="et"><br><br>

    <label for="contact">Contact:</label>
    <input type="text" name="contact" id="contact"><br><br>

    <label for="MAIL">Email:</label>
    <input type="text" name="MAIL" id="MAIL"><br><br>

    <label for="FEEDBACK">Feedback:</label>
    <input type="text" name="FEEDBACK" id="FEEDBACK"><br><br>

    <label for="Spedizione">Spedizione:</label>
    <input type="text" name="Spedizione" id="Spedizione"><br><br>

    <button type="button" onclick="generateHTMLCode()">Generate Raw HTML Code</button><br><br>

    <!-- Display the Raw HTML Code -->
    <h2>Raw HTML Code Output</h2>
    <pre id="raw-html-output"></pre>
</body>
</html>
